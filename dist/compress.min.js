var UploadCompress=function(t){this.clickCase=document.querySelectorAll(t.clickCase)[0],this.fileEle=document.querySelectorAll(t.fileEle)[0],this.maxHeight=t.maxHeight||1e3,this.maxWidth=t.maxWidth||1e3,this.callback=t.callback,this.threshold=t.threshold||204800};UploadCompress.prototype.init=function(){var t=this;this.clickCase.addEventListener("click",function(){t.fileEle.click()}),this.fileEle.addEventListener("change",function(){var e=this.files[0],a=new FileReader;a.readAsDataURL(e),a.onload=function(a){var i=this.result,r=new Image;i.length<=t.threshold?t.toPreviewer(i):(r.onload=function(){t.compress(r,e.type),r=null},r.src=i)}})},UploadCompress.prototype.compress=function(t,e){var a,i=document.createElement("canvas"),r=this;EXIF.getData(t,function(){switch(EXIF.getAllTags(t),Orientation=EXIF.getTag(t,"Orientation"),Orientation){case 6:a=r.rotateImg(t,"left",i,e);break;case 8:a=r.rotateImg(t,"right",i,e);break;case 3:r.rotateImg(t,"right",i,e),a=r.rotateImg(t,"right",i,e);break;default:a=t.src}r.smallMin(a)})},UploadCompress.prototype.rotateImg=function(t,e,a,i){if(null!=t){var r=t.height,h=t.width,o=2;null==o&&(o=0),"right"==e?++o>3&&(o=0):--o<0&&(o=3);var l=90*o*Math.PI/180,s=a.getContext("2d");switch(o){case 0:a.width=h,a.height=r,s.drawImage(t,0,0);break;case 1:a.width=r,a.height=h,s.rotate(l),s.drawImage(t,0,-r);break;case 2:a.width=h,a.height=r,s.rotate(l),s.drawImage(t,-h,-r);break;case 3:a.width=r,a.height=h,s.rotate(l),s.drawImage(t,-h,0)}return a.toDataURL(i,.75)}},UploadCompress.prototype.smallMin=function(t){var e=this,a=this.maxHeight,i=this.maxWidth,r=new Image;r.onload=function(){var t=document.createElement("canvas");r.width>i&&(r.height*=i/r.width,r.width=i),r.height>a&&(r.width*=a/r.height,r.height=a);var h=t.getContext("2d");h.clearRect(0,0,t.width,t.height),t.width=r.width,t.height=r.height,h.drawImage(r,0,0,r.width,r.height),e.toPreviewer(t.toDataURL())},r.src=t},UploadCompress.prototype.clearData=function(){this.fileEle.value=""},UploadCompress.prototype.toPreviewer=function(t){this.callback(t)};